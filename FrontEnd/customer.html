<!DOCTYPE html>
<!--
This is a starter template page. Use this page to start your new project from
scratch. This page gets rid of all links and provides the needed markup only.
-->
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>AdminLTE 2 | Starter</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="stylesheet" href="css/bootstrap.min.css"> <!-- added -->
    <!-- Font Awesome -->
    <link rel="stylesheet" href="css/font-awesome/css/font-awesome.min.css"> <!-- added -->
    <!-- Ionicons -->
    <link rel="stylesheet" href="css/Ionicons/css/ionicons.min.css"> <!-- added -->
    <!-- Theme style -->
    <link rel="stylesheet" href="css/AdminLTE.min.css"> <!-- added -->
    <!-- AdminLTE Skins. We have chosen the skin-blue for this starter
          page. However, you can choose any other skin. Make sure you
          apply the skin class to the body tag so the changes take effect. -->
    <link rel="stylesheet" href="css/skin-blue.min.css"> <!-- added -->

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css"
          integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/"
          crossorigin="anonymous">
    <![endif]-->

    <!-- Google Font -->
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">
    <style>
        .icon-delete {
            width: 20px;
            height: 20px;
            background-image: url('img/recyclebin.png');
            background-size: contain;
            background-position: center;
        }

        .icon-delete:hover:not(.icon-disabled) {
            background-image: url('img/recyclebin-hover.png');
        }

        .selected-row {
            background-color: yellow;
        }
    </style>
</head>
<!--
BODY TAG OPTIONS:
=================
Apply one or more of the following classes to get the
desired effect
|---------------------------------------------------------|
| SKINS         | skin-blue                               |
|               | skin-black                              |
|               | skin-purple                             |
|               | skin-yellow                             |
|               | skin-red                                |
|               | skin-green                              |
|---------------------------------------------------------|
|LAYOUT OPTIONS | fixed                                   |
|               | layout-boxed                            |
|               | layout-top-nav                          |
|               | sidebar-collapse                        |
|               | sidebar-mini                            |
|---------------------------------------------------------|
-->

<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">

    <!-- Main Header -->
    <header class="main-header">

        <!-- Logo --> <!-- this Part is needed -->
        <a href="index2.html" class="logo">
            <!-- mini logo for sidebar mini 50x50 pixels -->
            <span class="logo-mini"><b>A</b>LT</span>
            <!-- logo for regular state and mobile devices -->
            <span class="logo-lg"><b>POS System</b></span>
        </a>

        <!-- Header Navbar -->
        <nav class="navbar navbar-static-top" role="navigation">
            <!-- Sidebar toggle button-->
            <a href="#" class="sidebar-toggle" data-toggle="push-menu" role="button">
                <span class="sr-only">Toggle navigation</span>
            </a>
            <!-- Navbar Right Menu -->
            <div class="navbar-custom-menu">

            </div>
        </nav>
    </header>
    <!-- Left side column. contains the logo and sidebar -->
    <aside class="main-sidebar">

        <!-- sidebar: style can be found in sidebar.less -->
        <section class="sidebar">
            <!-- Sidebar Menu -->
            <ul class="sidebar-menu" data-widget="tree">
                <!-- Optionally, you can add icons to the links -->
                <li><a href="index.html"><i class="fa fa-link"></i> <span>Dashboard</span></a></li>
                <li class="active"><a href="customer.html"><i class="fa fa-link"></i> <span>Customers</span></a></li>
                <li><a href="item.html"><i class="fa fa-link"></i> <span>Items</span></a></li>
                <li><a href="placeorder.html"><i class="fa fa-link"></i> <span>Place Orders</span></a></li>
                <li><a href="order.html"><i class="fa fa-link"></i> <span>Orders</span></a></li>
            </ul>
        </section>
    </aside>

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <h1>
                Customer Details
            </h1>
        </section>

        <!-- Main content -->
        <section class="content container-fluid">

            <!--------------------------
            | Your Page Content Here |
            -------------------------->


            <div class="row">
                <div class="col-md-6">

                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <h3 class="box-title">Add New Customers</h3>
                        </div>
                        <!-- /.box-header -->
                        <!-- form start -->
                        <form role="form">
                            <div class="box-body">
                                <div class="form-group">
                                    <label>Customer ID</label>
                                    <input type="text" class="form-control" placeholder="Customer ID" id="txtId">
                                </div>
                                <div class="form-group">
                                    <label>Customer Name</label>
                                    <input type="text" class="form-control" placeholder="Customer Name" id="txtName">
                                </div>
                                <div class="form-group">
                                    <label>Customer Address</label>
                                    <input type="text" class="form-control" placeholder="Customer Address"
                                           id="txtAddress">
                                </div>
                            </div>
                            <!-- /.box-body -->
                            <div class="box-footer" style="text-align: right;">
                                <button type="button" class="btn btn-primary" id="btnSave">Save</button>
                                <button type="reset" class="btn btn-danger">Clear</button>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="col-md-6">

                    <div class="box">
                        <div class="box-header">
                            <h3 class="box-title">All Customers In the System</h3>
                        </div>
                        <!-- /.box-header -->
                        <div class="box-body">
                            <div id="example2_wrapper" class="dataTables_wrapper form-inline dt-bootstrap">
                                <div class="row">
                                    <div class="col-sm-6"></div>
                                    <div class="col-sm-6"></div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-12">
                                        <table id="example2" class="table table-bordered table-hover dataTable"
                                               role="grid" aria-describedby="example2_info">
                                            <thead>
                                            <tr role="row">
                                                <th class="sorting_asc" tabindex="0" aria-controls="example2"
                                                    rowspan="1" colspan="1" aria-sort="ascending">Customer ID
                                                </th>
                                                <th class="sorting" tabindex="0" aria-controls="example2" rowspan="1"
                                                    colspan="1">Customer Name
                                                </th>
                                                <th class="sorting" tabindex="0" aria-controls="example2" rowspan="1"
                                                    colspan="1">Customer Address
                                                </th>
                                                <th class="sorting" tabindex="0" aria-controls="example2" rowspan="1"
                                                    colspan="1">Delete
                                                </th>
                                            </thead>
                                            <tbody id="tblAllcustomers">

                                            </tbody>
                                            <tfoot>
                                            </tfoot>
                                        </table>
                                    </div>
                                    <!-- /.box-body -->
                                </div>


                            </div>
                        </div>


        </section>
        <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->

    <!-- Main Footer -->
    <footer class="main-footer">
        <!-- Default to the left -->
        <strong>Copyright &copy; 2016 <a href="#">IJSE</a>.</strong> All rights reserved.
    </footer>

    <!-- Add the sidebar's background. This div must be placed
  immediately after the control sidebar -->
    <div class="control-sidebar-bg"></div>
</div>
<!-- ./wrapper -->

<!-- REQUIRED JS SCRIPTS -->

<!-- jQuery 3 -->
<script src="js/jquery.min.js"></script> <!-- added -->
<!-- Bootstrap 3.3.7 -->
<script src="js/bootstrap.min.js"></script>
<!-- AdminLTE App -->
<script src="js/adminlte.min.js"></script>

<script>

    $('button[type="reset"]').click(function () {
        $("#tblAllcustomers tr").removeClass("selected-row");
    });

    window.onload = function () {
        loadtabele();
    }

    function loadtabele() {

        var ajaxConfig = {
            method: "GET",
            url: "http://localhost:3000/api/v1/customers",
            async: true
        };

        $.ajax(ajaxConfig).done(function (responseText, statusText, jxhr) {

            $("#tblAllcustomers tr").remove();

            var filltable;

            for (var i = 0; i < responseText.length; i++) {
                filltable = filltable + `<tr role="row" class="odd">
                            <td class="sorting_1">${responseText[i].c_id}</td>
                            <td>${responseText[i].c_name}</td>
                            <td>${responseText[i].c_address}</td>
                            <td><div class="icon-delete"></div></td>
                          </tr>`;
            }

            $("#tblAllcustomers").append(filltable);

            $(".icon-delete").off("click");
            $(".icon-delete").click(function (eventData) {
                eventData.stopPropagation();
                if (confirm("Are you sure that you want to delete this customer ?")) {

                    var customerID = $(this).parents("tr").find("td:nth-child(1)").text();

                    $(this).parents("tr").fadeOut(500, function () {
                       // $(this).parents("tr").remove();
                    });

                    var ajaxConfig = {
                        method: "DELETE",
                        url: "http://localhost:3000/api/v1/customers/" + customerID,
                        async: true
                    };

                    $.ajax(ajaxConfig).done(function (response, statusText, jxhr) {
                        alert("Successfully Deleted");
                    }).fail(function (jxhr, statusText, err) {
                        alert("Can not Delete the customer. Try Again");
                        console.log(err);
                    })

                }
            });

            $("#tblAllcustomers tr").off("click");
            $("#tblAllcustomers tr").click(function () {

                var customerID = $(this).find("td:first-child").text();
                var customerName = $(this).find("td:nth-child(2)").text();
                var customerAddress = $(this).find("td:nth-child(3)").text();

                $("#txtId").val(customerID);
                $("#txtName").val(customerName);
                $("#txtAddress").val(customerAddress);

                $("#tblAllcustomers tr").removeClass("selected-row");
                $(this).addClass("selected-row");
                $("#txtId").attr("disabled", true);

            });

        }).fail(function (jxhr, statusText, error) {

        });

    }

    $("#btnSave").click(function () {
        //txtId is Disabled. So it an Update
        if ($("#txtId").attr("disabled") == "disabled") {

            var customer = {
                c_id: $("#txtId").val(),
                c_name: $("#txtName").val(),
                c_address: $("#txtAddress").val()
            };

            var ajaxConfig = {
                method: "PUT",
                url: "http://localhost:3000/api/v1/customers/" + $("#txtId").val(),
                async: true,
                contentType: "application/json",
                data: JSON.stringify(customer)
            };

            $.ajax(ajaxConfig).done(function (response, statusText, jxhr) {
                alert("Customer Successfully Updated");
                loadtabele();
                $("#txtId").attr("disabled", false);
                $('button[type="reset"]').trigger("click");
            }).fail(function (jxhr, statusText, error) {
                alert("Unable to save customer , try again");
                console.log(error);
            })

        } else {

            var customer = {
                c_id: $("#txtId").val(),
                c_name: $("#txtName").val(),
                c_address: $("#txtAddress").val()
            };

            var ajaxConfig = {
                method: "POST",
                url: "http://localhost:3000/api/v1/customers",
                async: true,
                contentType: "application/json",
                data: JSON.stringify(customer)
            };

            $.ajax(ajaxConfig).done(function (respone, statusText, jxhr) {
                alert("Customer Successfully Saved");
                loadtabele();
                $('button[type="reset"]').trigger("click");
            })

        }
    });

</script>
</body>

</html>